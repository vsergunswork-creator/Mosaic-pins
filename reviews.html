<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Reviews ‚Äî Mosaic Pins</title>

  <style>
    :root{
      --bg:#0b0d11;
      --text:#e9eef7;
      --muted:#a8b3c7;
      --line:rgba(255,255,255,.08);
      --shadow: 0 12px 30px rgba(0,0,0,.45);
      --r:18px;

      --overlay: rgba(0,0,0,.72);
      --overlay2: rgba(0,0,0,.82);
      --panel: rgba(0,0,0,.28);
      --panelHover: rgba(255,255,255,.05);
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: var(--bg);
      color:var(--text);
      overflow:hidden;
      position:relative;
      isolation:isolate;
    }

    body::before{
      content:"";
      position:fixed;
      inset:-20vh -20vw;
      z-index:-1;
      pointer-events:none;
      background:
        radial-gradient(1100px 700px at 35% -10%, rgba(50,220,150,.25), transparent 55%),
        radial-gradient(900px 600px at 75% 10%, rgba(120,90,255,.22), transparent 55%),
        var(--bg);
      filter: blur(18px) saturate(1.05);
      transform: translateZ(0);
      will-change: transform;
    }

    /* scrollbars */
    *{
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,.18) rgba(0,0,0,.25);
    }
    *::-webkit-scrollbar{width:10px;height:10px}
    *::-webkit-scrollbar-track{background:rgba(0,0,0,.25); border-radius:999px}
    *::-webkit-scrollbar-thumb{background:rgba(255,255,255,.18); border-radius:999px; border:2px solid rgba(0,0,0,.25)}
    *::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.25)}

    .app{display:grid; grid-template-columns: 280px 1fr; height:100vh; gap:16px; padding:16px;}

    /* ===== Sidebar ===== */
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    .sb-top{
      padding:18px 18px 10px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex:0 0 auto;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.4px;}
    .dot{width:10px;height:10px;border-radius:50%; background:linear-gradient(135deg,#22c55e,#60a5fa);}
    .pill{
      padding:8px 10px; border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }

    .sb-nav{padding:6px; display:grid; gap:6px; flex:0 0 auto;}
    .nav-item{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:12px;
      color:var(--muted);
      text-decoration:none;
      border:1px solid transparent;
    }
    .nav-item:hover{background:rgba(255,255,255,.05); color:var(--text);}
    .nav-item.active{
      background:rgba(34,197,94,.12);
      border-color: rgba(34,197,94,.22);
      color:var(--text);
    }

    .sb-scroll{
      flex:1 1 auto;
      min-height:0;
      overflow:auto;
      padding:6px 6px 10px;
      position:relative;
    }
    .sb-scroll:before,
    .sb-scroll:after{
      content:"";
      position:sticky;
      left:0; right:0;
      height:14px;
      pointer-events:none;
      z-index:2;
      display:block;
    }
    .sb-scroll:before{
      top:0;
      background: linear-gradient(180deg, rgba(11,13,17,.95), rgba(11,13,17,0));
    }
    .sb-scroll:after{
      bottom:0;
      background: linear-gradient(0deg, rgba(11,13,17,.95), rgba(11,13,17,0));
    }

    .sb-card{
      margin:0 6px 10px;
      padding:12px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
    }
    .sb-card h3{
      margin:0 0 6px;
      font-size:13px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .sb-card p{
      margin:0;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
      white-space:pre-line;
    }

    /* ===== Main ===== */
    .main{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-width:0;
      min-height:0;
    }

    .topbar{
      padding: calc(16px + env(safe-area-inset-top)) 18px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(34,197,94,.14), rgba(0,0,0,0));
      flex:0 0 auto;
    }
    .top-left{display:flex; align-items:center; gap:10px; min-width:0}
    .h-title{font-weight:900; font-size:18px; margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .sub{color:var(--muted); font-size:12px; margin-top:4px}

    .top-right{display:flex; align-items:center; gap:10px; flex-wrap:wrap;}

    .cartBtn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.28);
      border:1px solid var(--line);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
      white-space:nowrap;
      min-height:44px;
      line-height:1.1;
    }
    .cartBtn:hover{background:rgba(255,255,255,.06)}
    .cartBadge{
      padding:4px 8px;
      border-radius:999px;
      background:rgba(34,197,94,.18);
      border:1px solid rgba(34,197,94,.25);
      color:var(--text);
      font-size:12px;
      font-weight:900;
      line-height:1;
      min-width:24px;
      text-align:center;
    }

    .shipCountry, .currency{
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      color:var(--text);
      font-size:13px;
      outline:none;
      white-space:nowrap;
      min-height:44px;
      appearance:none;
    }

    .content{
      padding:18px;
      overflow:auto;
      min-height:0;
      flex: 1 1 auto;
    }

    /* ===== Buttons ===== */
    .btn{
      border:none; cursor:pointer;
      padding:12px 14px;
      border-radius:14px;
      background:linear-gradient(135deg,#22c55e,#16a34a);
      color:#07110b;
      font-weight:950;
      box-shadow: 0 10px 18px rgba(34,197,94,.18);
      transition: filter .15s ease, transform .15s ease;
      white-space:nowrap;
      width:100%;
    }
    .btn:hover{filter:brightness(1.05); transform: translateY(-1px)}
    .btn:disabled{
      cursor:not-allowed;
      background:rgba(255,255,255,.10);
      color:rgba(255,255,255,.55);
      box-shadow:none;
      transform:none;
    }

    .btn2{
      border:none; cursor:pointer;
      padding:12px 14px;
      border-radius:14px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:950;
      transition: background .15s ease, transform .15s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      text-decoration:none;
      width:100%;
      min-height:44px;
    }
    .btn2:hover{background:rgba(255,255,255,.10); transform: translateY(-1px)}
    .btn2:disabled{opacity:.45; cursor:not-allowed}

    /* ===== Reviews blocks ===== */
    .hero{
      border-radius:18px;
      border:1px solid var(--line);
      overflow:hidden;
      background:rgba(0,0,0,.22);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .heroRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }
    .heroTitle{
      margin:0;
      font-size:16px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .heroMeta{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.4;
    }

    .avgBox{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      min-height:44px;
    }
    .avgNum{font-weight:950; font-size:18px; letter-spacing:.2px;}
    .avgSub{color:var(--muted); font-size:12px;}

    .grid2{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:start;
    }

    .panel{
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .panelHead{
      padding:14px 16px 12px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(34,197,94,.14), rgba(0,0,0,0));
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .panelTitle{margin:0; font-weight:950; letter-spacing:.2px; font-size:14px;}
    .hint{font-size:12px; color:var(--muted); opacity:.9;}
    .panelBody{padding:14px 16px 16px;}

    .field{display:grid; gap:8px; margin-bottom:12px;}
    .label{font-size:12px; color:var(--muted);}
    .input, .textarea{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
    }
    .textarea{min-height:110px; resize:vertical;}

    .formRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    .starsPick{
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
      flex-wrap:wrap;
    }
    .starBtn{
      width:38px; height:38px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      font-size:18px;
      line-height:1;
      display:flex; align-items:center; justify-content:center;
      transition: transform .12s ease, background .12s ease;
    }
    .starBtn:hover{background:rgba(255,255,255,.08); transform: translateY(-1px);}
    .starBtn.active{background:rgba(34,197,94,.16); border-color: rgba(34,197,94,.25);}
    .ratingText{color:var(--muted); font-size:12px;}

    .list{display:grid; gap:12px;}
    .review{
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:12px;
    }
    .rTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .rName{font-weight:950; letter-spacing:.2px; margin:0; font-size:13px;}
    .rDate{color:var(--muted); font-size:12px;}
    .rStars{display:flex; gap:2px; font-size:14px; line-height:1; white-space:nowrap;}
    .rText{
      margin:10px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.55;
      white-space:pre-line;
    }

    .empty{
      padding:14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.20);
      color:var(--muted);
      font-size:13px;
    }

    /* ‚úÖ photos grid inside review */
    .rPhotos{
      margin-top:10px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .rPhoto{
      width:72px;height:72px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      overflow:hidden;
      cursor:pointer;
    }
    .rPhoto img{width:100%;height:100%;object-fit:cover;display:block;}

    /* ‚úÖ Footer */
    .footer{
      margin-top:auto;
      border-top:1px solid var(--line);
      background: rgba(0,0,0,.25);
      padding:14px 18px;
      flex: 0 0 auto;
    }
    .footerRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .footerBrand{
      display:flex;
      align-items:center;
      gap:10px;
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .footerLinks{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .footerLinks a{
      text-decoration:none;
      color:var(--muted);
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      transition: background .15s ease, transform .15s ease;
      white-space:nowrap;
    }
    .footerLinks a:hover{
      background:rgba(255,255,255,.08);
      transform: translateY(-1px);
      color:var(--text);
    }

    /* ‚úÖ Cart Drawer */
    .cartBack{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.74);
      display:none;
      z-index:1100;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .cartBack.show{display:block}

    .cartDrawer{
      position:fixed;
      top:0; right:0; bottom:0;
      width:min(420px, 92vw);
      border-left:1px solid var(--line);
      background: linear-gradient(180deg, rgba(0,0,0,.92), rgba(0,0,0,.78));
      box-shadow: -18px 0 40px rgba(0,0,0,.60);
      transform: translateX(100%);
      transition: transform .18s ease;
      z-index:1101;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .cartDrawer.show{transform: translateX(0)}
    .cartHead{
      padding:14px 14px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(34,197,94,.14), rgba(0,0,0,0));
    }
    .cartTitle{font-weight:950; letter-spacing:.2px;}
    .cartClose{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(0,0,0,.30);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:950;
      line-height:1;
    }
    .cartClose:hover{background:rgba(255,255,255,.06)}
    .cartBody{padding:12px; overflow:auto; min-height:0;}
    .cartEmpty{
      padding:14px;
      border:1px solid var(--line);
      border-radius:14px;
      background:rgba(255,255,255,.04);
      color:var(--muted);
    }
    .cartItem{
      display:grid;
      grid-template-columns:64px 1fr;
      gap:10px;
      padding:10px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      margin-bottom:10px;
    }
    .cartImg{
      width:64px;height:64px;border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
      color:var(--muted);
      font-size:12px;
    }
    .cartImg img{width:100%;height:100%;object-fit:cover;display:block;}
    .cartName{font-weight:900; font-size:13px; margin:0}
    .cartMeta{color:var(--muted); font-size:12px; margin:4px 0 0}
    .cartRow{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:10px;}
    .cartQty{
      display:flex; align-items:center; gap:6px;
      padding:6px 8px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.25);
    }
    .cartQty button{
      width:30px;height:30px;border-radius:10px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      font-weight:900;
    }
    .cartQty input{
      width:44px;
      background:transparent;
      border:none;
      outline:none;
      color:var(--text);
      text-align:center;
      font-weight:900;
    }
    .cartRemove{
      border:none;
      cursor:pointer;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(0,0,0,.25);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:900;
      line-height:1;
    }
    .cartRemove:hover{background:rgba(255,255,255,.06)}
    .cartFoot{
      padding:12px;
      border-top:1px solid var(--line);
      background:rgba(0,0,0,.40);
      padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px));
    }
    .cartSumRow{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px; color:var(--text); font-weight:950;}

    /* =========================
       ‚úÖ NEW: 3 buttons in a row –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (–∫–∞–∫ Clear cart)
       PayPal / Checkout / Clear cart
       ========================= */
    .cartActions{display:grid; gap:10px;}

    .actionRow{
      display:grid;
      grid-template-columns:1fr 1fr 1fr;
      gap:10px;
      align-items:stretch;
    }
    .actionBtn{
      width:100%;
      min-height:44px;
      height:44px;
      padding:0 12px;
      line-height:44px;
      border-radius:12px;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden; /* –≤–∞–∂–Ω–æ –¥–ª—è PayPal iframe */
    }

    /* PayPal wrapper –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ã—á–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
    .ppWrap{
      display:none; /* –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∫–æ—Ä–∑–∏–Ω–∞ –Ω–µ –ø—É—Å—Ç–∞—è */
      padding:0;
    }
    #paypal-button-container{
      width:100%;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* note under row */
    .ppNote{
      color:var(--muted);
      font-size:12px;
      margin-top:0;
      line-height:1.35;
      display:none;
      text-align:center;
    }

    @media (max-width:520px){
      .actionRow{grid-template-columns:1fr;}
      .actionBtn{height:46px; min-height:46px; line-height:46px;}
    }

    /* ‚úÖ Checkout green (only this button) */
    #cartCheckout{
      background: linear-gradient(135deg,#22c55e,#16a34a);
      color:#07110b;
      border:none;
      box-shadow: 0 10px 18px rgba(34,197,94,.18);
    }
    #cartCheckout:hover{
      filter: brightness(1.05);
      transform: translateY(-1px);
    }
    #cartCheckout:disabled{
      background: rgba(255,255,255,.10);
      color: rgba(255,255,255,.55);
      box-shadow:none;
      transform:none;
    }

    /* ‚úÖ Lightbox */
    .lightboxBack{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.72);
      display:none;
      z-index:2200;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    .lightboxBack.show{display:block}
    .lightbox{
      position:fixed;
      inset:0;
      display:none;
      z-index:2201;
      align-items:center;
      justify-content:center;
      padding:16px;
    }
    .lightbox.show{display:flex}
    .lightboxCard{
      width:min(920px, 96vw);
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.55);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .lbTop{
      padding:12px 12px 10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(34,197,94,.12), rgba(0,0,0,0));
    }
    .lbPill{
      padding:8px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--muted);
      font-size:12px;
      white-space:nowrap;
    }
    .lbClose{
      border:none;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background:rgba(0,0,0,.30);
      border:1px solid var(--line);
      color:var(--text);
      font-weight:950;
      line-height:1;
    }
    .lbClose:hover{background:rgba(255,255,255,.06)}
    .lightboxImg{
      width:100%;
      height:auto;
      display:block;
      max-height: 78vh;
      object-fit: contain;
      background: rgba(0,0,0,.35);
    }

    /* ‚úÖ Toast */
    .toast{
      position: fixed;
      right: 16px;
      bottom: 16px;
      background: rgba(0,0,0,.65);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px 14px;
      color: var(--text);
      box-shadow: var(--shadow);
      max-width: 360px;
      display:none;
      z-index:2605;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .toast.show{display:block}
    .toast small{color:var(--muted)}

    /* ‚úÖ Back to shop ONLY on mobile */
    .onlyMobile{display:none;}

    /* ===== Responsive ===== */
    @media (max-width:980px){
      body{overflow:auto}
      .app{grid-template-columns:1fr; height:auto; min-height:100vh}
      .sidebar{display:none}
      .main{height:auto; min-height:100vh}
      .grid2{grid-template-columns:1fr;}
      .formRow{grid-template-columns:1fr;}

      .content{
        padding:14px;
        /* mobile bottom nav removed => no +86px */
        padding-bottom: calc(14px + env(safe-area-inset-bottom));
      }

      .onlyMobile{display:block;}

      .footer{padding:12px 14px;}
      .footerRow{justify-content:center;}
      .footerLinks{justify-content:center;}

      /* ‚úÖ remove heavy blur on mobile (less lag) */
      .cartDrawer,
      .cartBack,
      .toast,
      .lightboxBack{
        backdrop-filter:none !important;
        -webkit-backdrop-filter:none !important;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar">
      <div class="sb-top">
        <div class="brand"><span class="dot"></span> Mosaic Pins</div>
        <div class="pill">Reviews</div>
      </div>

      <nav class="sb-nav">
        <a class="nav-item" href="/" id="navShop">Shop</a>
        <a class="nav-item" href="/about" id="navAbout">About</a>
        <a class="nav-item active" href="/reviews" id="navReviews">Reviews</a>
        <a class="nav-item" href="/shipping" id="navShipping">Shipping</a>
        <a class="nav-item" href="/returns" id="navReturns">Returns</a>
      </nav>

      <div class="sb-scroll">
        <div class="sb-card">
          <h3>How it works</h3>
          <p>
            Leave a review ‚Äî it will appear after approval.<br/>
            Rating: 1‚Äì5 stars.
          </p>
        </div>

        <div class="sb-card">
          <h3>Contact</h3>
          <p>
            <a style="color:var(--text); text-decoration:none; opacity:.9" href="mailto:support@mosaicpins.space">
              support@mosaicpins.space
            </a>
          </p>
        </div>
      </div>
    </aside>

    <main class="main">
      <div class="topbar">
        <div class="top-left">
          <div>
            <h1 class="h-title" id="topTitle">Reviews</h1>
            <div class="sub" id="topSub">Mosaic Pins Space</div>
          </div>
        </div>

        <div class="top-right">
          <button class="cartBtn" id="openCart" type="button" title="Cart">
            üõí Cart <span class="cartBadge" id="cartBadge">0</span>
          </button>

          <select class="shipCountry" id="shipCountry" title="Shipping country">
            <option value="DE">Germany (DE)</option>
            <option value="EU">Europe (EU)</option>
            <option value="US">United States (US)</option>
            <option value="CA">Canada (CA)</option>
          </select>
        </div>
      </div>

      <div class="content">
        <section class="hero">
          <div class="heroRow">
            <div>
              <h2 class="heroTitle">Customer reviews</h2>
              <div class="heroMeta" id="heroMeta">Loading‚Ä¶</div>
            </div>

            <div class="avgBox" aria-label="Average rating">
              <div class="avgNum" id="avgNum">‚Äî</div>
              <div>
                <div class="rStars" id="avgStars" aria-label="Average stars">‚Äî</div>
                <div class="avgSub" id="avgSub">‚Äî</div>
              </div>
            </div>
          </div>
        </section>

        <div class="grid2">
          <section class="panel">
            <div class="panelHead">
              <h3 class="panelTitle">Leave a review</h3>
              <div class="hint">Will be published after approval</div>
            </div>

            <div class="panelBody">
              <div class="formRow">
                <div class="field">
                  <div class="label">Name</div>
                  <input class="input" id="name" placeholder="Your name" maxlength="60" />
                </div>

                <div class="field">
                  <div class="label">Country (optional)</div>
                  <input class="input" id="country" placeholder="Germany, USA‚Ä¶" maxlength="40" />
                </div>
              </div>

              <div class="field">
                <div class="label">Rating</div>
                <div class="starsPick" id="starsPick" aria-label="Choose rating">
                  <div class="ratingText" id="ratingText">Selected: 5/5</div>
                </div>
              </div>

              <div class="field">
                <div class="label">Review text</div>
                <textarea class="textarea" id="text" placeholder="Tell us what you liked‚Ä¶" maxlength="1200"></textarea>
              </div>

              <button class="btn" id="sendBtn" type="button">Send review</button>

              <div style="margin-top:10px; color:var(--muted); font-size:12px;">
                Thank you very much for your feedback! üòâ
              </div>

              <!-- ‚úÖ Back button ONLY on mobile -->
              <div class="onlyMobile" style="margin-top:12px;">
                <a class="btn2" href="/" aria-label="Back to shop">
                  ‚Üê Back to Shop
                </a>
              </div>
            </div>
          </section>

          <section class="panel">
            <div class="panelHead">
              <h3 class="panelTitle">Approved reviews</h3>
              <div class="hint" id="countHint">‚Äî</div>
            </div>

            <div class="panelBody">
              <div class="list" id="list"></div>
            </div>
          </section>
        </div>
      </div>

      <!-- ‚úÖ Footer -->
      <footer class="footer">
        <div class="footerRow">
          <div class="footerBrand">
            <span class="dot" aria-hidden="true"></span>
            <span>¬© <span id="year"></span> Mosaic Pins</span>
          </div>

          <div class="footerLinks" aria-label="Footer links">
            <a href="/index">Shop</a>
            <a href="/about">About</a>
            <a href="/shipping">Shipping</a>
            <a href="/returns">Returns</a>
            <a href="/reviews">Reviews</a>
            <a href="/privacy.html">Privacy Policy</a>
            <a href="/impressum.html">Impressum</a>
            <a href="mailto:mosaicpinsspace@gmail.com">Support</a>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <!-- ‚úÖ CART (drawer) -->
  <div class="cartBack" id="cartBack"></div>
  <div class="cartDrawer" id="cartDrawer">
    <div class="cartHead">
      <div class="cartTitle">Cart</div>
      <button class="cartClose" id="closeCart" type="button">‚úï</button>
    </div>

    <div class="cartBody" id="cartBody"></div>

    <div class="cartFoot">

      <div class="cartSumRow">
        <div>Total</div>
        <div id="cartTotal">‚Äî</div>
      </div>

      <div class="cartActions">

        <div class="actionRow">
          <div class="ppWrap btn2 actionBtn" id="ppWrap">
            <div id="paypal-button-container"></div>
          </div>

          <button class="btn2 actionBtn" id="cartCheckout" type="button">Checkout</button>

          <button class="btn2 actionBtn" id="cartClear" type="button">Clear cart</button>
        </div>

        <div class="ppNote" id="ppNote">PayPal is loading‚Ä¶</div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">
    <div style="font-weight:800" id="toastTitle">Notice</div>
    <small id="toastMsg">‚Äî</small>
  </div>

  <!-- PayPal SDK placeholder -->
  <script id="pp-sdk" data-loaded="0"></script>

<script>

// ‚úÖ footer year
  (function(){
    const y = document.getElementById("year");
    if (y) y.textContent = String(new Date().getFullYear());
  })();

  const API_REVIEWS  = "/api/reviews";
  const API_CHECKOUT = "/api/checkout";

  const CART_KEY     = "mp_cart";
  const CURRENCY_KEY = "mp_currency";
  const SHIP_KEY     = "mp_ship_country";

  function el(id){ return document.getElementById(id); }

  function readCart(){
    try{
      const raw = localStorage.getItem(CART_KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    }catch(_){ return []; }
  }
  function writeCart(arr){
    try{ localStorage.setItem(CART_KEY, JSON.stringify(arr)); }catch(_){}
  }
  function cartCount(){
    return readCart().reduce((s,it)=> s + (Number(it?.qty)||0), 0);
  }

  function escapeHtml(s){
    return String(s||"").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  // ======================
  // Toast
  // ======================
  const toastEl    = el("toast");
  const toastTitle = el("toastTitle");
  const toastMsg   = el("toastMsg");

  function toast(title, msg){
    if (!toastEl || !toastTitle || !toastMsg) return;
    toastTitle.textContent = String(title || "Notice");
    toastMsg.textContent   = String(msg || "");
    toastEl.classList.add("show");
    clearTimeout(toastEl.__t);
    toastEl.__t = setTimeout(()=> toastEl.classList.remove("show"), 2600);
  }

  // ==========================
  // Shipping + Currency (same rules)
  // ==========================
  const elShipCountry = el("shipCountry");

  function isMobile(){
    return window.matchMedia && window.matchMedia("(max-width: 980px)").matches;
  }

  // ‚úÖ hard rule: US/CA => USD, DE/EU => EUR
  function mustCurrencyByShip(ship){
    ship = String(ship || "DE").toUpperCase();
    return (ship === "US" || ship === "CA") ? "USD" : "EUR";
  }

  function getCurrency(){
    const saved = (localStorage.getItem(CURRENCY_KEY) || "").toUpperCase();
    if (saved === "EUR" || saved === "USD") return saved;
    // currency select removed from UI in this page; fallback:
    return mustCurrencyByShip(elShipCountry?.value || "DE");
  }

  function setCurrency(cur){
    cur = String(cur || "EUR").toUpperCase();
    if (cur !== "EUR" && cur !== "USD") cur = "EUR";
    try{ localStorage.setItem(CURRENCY_KEY, cur); }catch(_){}
  }

  function enforceCurrencyByShipping(){
    const ship = String(elShipCountry?.value || "DE").toUpperCase();
    const must = mustCurrencyByShip(ship);
    if (getCurrency() !== must){
      setCurrency(must);
      toast("Currency", `Auto set: ${must}`);
    }
  }

  (function restoreShippingAndCurrency(){
    try{
      // restore shipping
      const ship = (localStorage.getItem(SHIP_KEY) || "").toUpperCase();
      if (ship && ["DE","EU","US","CA"].includes(ship) && elShipCountry) elShipCountry.value = ship;

      // first time guess shipping if not set
      if (!localStorage.getItem(SHIP_KEY) && elShipCountry){
        let guess = "DE";
        try{
          const loc = (navigator.language || "").split("-")[1] || "";
          const cc = String(loc).toUpperCase();
          if (cc === "US") guess = "US";
          else if (cc === "CA") guess = "CA";
          else if (cc === "DE") guess = "DE";
          else if (cc) guess = "EU";
        }catch(_){}
        elShipCountry.value = guess;
        try{ localStorage.setItem(SHIP_KEY, guess); }catch(_){}
      }

      // enforce currency once
      enforceCurrencyByShipping();
      setCurrency(getCurrency());
    }catch(_){}
  })();

  if (elShipCountry){
    elShipCountry.addEventListener("change", () => {
      try{ localStorage.setItem(SHIP_KEY, String(elShipCountry.value || "DE").toUpperCase()); }catch(_){}
      enforceCurrencyByShipping();

      // ‚úÖ IMPORTANT: on ship change re-render cart + reset paypal
      renderCart();
      resetPayPalUI();

      toast("Shipping", `Destination: ${elShipCountry.value}`);
    });
  }

  // ‚úÖ Map UI selection -> ISO2 for API
  // IMPORTANT: EU must send a real EU ISO2 code so backend detectZone() returns "EU"
  function getShippingCountryISO2(){
    const v = String(elShipCountry?.value || "DE").toUpperCase();
    if (v === "US") return "US";
    if (v === "CA") return "CA";
    if (v === "EU") return "FR"; // any EU ISO2 works
    return "DE";
  }

  // ==========================
  // CART (Drawer)
  // ==========================
  const elCartBadge    = el("cartBadge");
  const elOpenCart     = el("openCart");
  const elCartBack     = el("cartBack");
  const elCartDrawer   = el("cartDrawer");
  const elCloseCart    = el("closeCart");
  const elCartBody     = el("cartBody");
  const elCartTotal    = el("cartTotal");
  const elCartCheckout = el("cartCheckout");
  const elCartClear    = el("cartClear");

  // NEW paypal ui refs
  const elPpWrap = el("ppWrap");
  const elPpNote = el("ppNote");
  const elPpBox  = el("paypal-button-container");
  const elPpSdk  = el("pp-sdk");

  function updateCartBadge(){
    if (elCartBadge) elCartBadge.textContent = String(cartCount());
  }

  function openCart(){
    if (!elCartBack || !elCartDrawer) return;
    elCartBack.classList.add("show");
    elCartDrawer.classList.add("show");
    if (!isMobile()) document.body.style.overflow = "hidden";
    renderCart();
    // show paypal only when cart not empty
    maybeInitPayPal();
  }

  function closeCart(){
    elCartBack?.classList.remove("show");
    elCartDrawer?.classList.remove("show");
    document.body.style.overflow = "";
  }

  elOpenCart?.addEventListener("click", openCart);
  elCloseCart?.addEventListener("click", closeCart);
  elCartBack?.addEventListener("click", closeCart);

  // ‚úÖ ESC closes cart + photo (same)
  window.addEventListener("keydown", (e)=>{
    if (e.key !== "Escape") return;
    const lbOpen = el("lightbox")?.classList.contains("show");
    const cartOpen = elCartDrawer?.classList.contains("show");
    if (cartOpen && !lbOpen) closeCart();
    closePhoto();
  });

  function setCartQty(pin, qty){
    const cart = readCart();
    const idx = cart.findIndex(x => String(x.pin) === String(pin));
    if (idx < 0) return;

    const stock = Number(cart[idx].stock ?? 0);
    qty = Number(qty);
    if (!Number.isFinite(qty)) qty = 1;
    qty = Math.max(1, qty);
    if (stock > 0) qty = Math.min(stock, qty);

    cart[idx].qty = qty;
    writeCart(cart);
    updateCartBadge();
    renderCart();
    resetPayPalUI();
  }

  function removeFromCart(pin){
    const cart = readCart().filter(x => String(x.pin) !== String(pin));
    writeCart(cart);
    updateCartBadge();
    renderCart();
    resetPayPalUI();
  }

  function clearCart(){
    writeCart([]);
    updateCartBadge();
    renderCart();
    resetPayPalUI();
  }

  function cartTotal(){
    const cur = getCurrency();
    const cart = readCart();
    let sum = 0;
    for (const it of cart){
      const unit = Number(it?.price?.[cur]);
      if (Number.isFinite(unit)) sum += unit * (Number(it?.qty)||0);
    }
    return sum;
  }

  function priceTextFromItem(it, cur){
    const unit = it?.price?.[cur];
    if (typeof unit !== "number") return "‚Äî";
    return cur === "EUR" ? `${unit.toFixed(2)} ‚Ç¨` : `${unit.toFixed(2)} $`;
  }

  function renderCart(){
    if (!elCartBody || !elCartTotal || !elCartCheckout) return;

    const cart = readCart();
    const cur = getCurrency();

    // paypal visible only if cart has items
    if (elPpWrap) elPpWrap.style.display = cart.length ? "flex" : "none";
    if (elPpNote) elPpNote.style.display = cart.length ? "block" : "none";

    if (!cart.length){
      elCartBody.innerHTML = `<div class="cartEmpty">Your cart is empty.</div>`;
      elCartTotal.textContent = "‚Äî";
      elCartCheckout.disabled = true;
      elCartCheckout.textContent = "Checkout";
      if (elPpNote) elPpNote.textContent = "";
      return;
    }

    elCartCheckout.disabled = false;
    elCartCheckout.textContent = "Checkout";

    elCartBody.innerHTML = cart.map(it => {
      const img = it.image
        ? `<img src="${escapeHtml(it.image)}" alt="${escapeHtml(it.title)}" />`
        : `<span>‚Äî</span>`;

      const unitText = priceTextFromItem(it, cur);

      return `
        <div class="cartItem" data-pin="${escapeHtml(String(it.pin || ""))}">
          <div class="cartImg">${img}</div>
          <div>
            <p class="cartName">${escapeHtml(it.title || it.pin)}</p>
            <div class="cartMeta">${escapeHtml(it.pin)} ‚Ä¢ ${unitText}</div>
            <div class="cartRow">
              <div class="cartQty">
                <button type="button" data-act="minus">‚àí</button>
                <input value="${escapeHtml(String(it.qty || 1))}" inputmode="numeric" />
                <button type="button" data-act="plus">+</button>
              </div>
              <button class="cartRemove" type="button" data-act="remove">‚úï</button>
            </div>
            <div class="cartMeta" style="margin-top:8px;">Stock: ${escapeHtml(it.stock ?? "‚Äî")}</div>
          </div>
        </div>
      `;
    }).join("");

    Array.from(elCartBody.querySelectorAll(".cartItem")).forEach(row => {
      const pin = row.getAttribute("data-pin") || "";
      const input = row.querySelector("input");

      row.querySelector('button[data-act="minus"]')?.addEventListener("click", () => {
        setCartQty(pin, Number(input?.value) - 1);
      });
      row.querySelector('button[data-act="plus"]')?.addEventListener("click", () => {
        setCartQty(pin, Number(input?.value) + 1);
      });

      input?.addEventListener("input", () => {
        const v = Number(input.value);
        if (!Number.isFinite(v)) return;
        setCartQty(pin, v);
      });

      row.querySelector('button[data-act="remove"]')?.addEventListener("click", () => removeFromCart(pin));
    });

    const sum = cartTotal();
    elCartTotal.textContent = (cur==="EUR") ? `${sum.toFixed(2)} ‚Ç¨` : `${sum.toFixed(2)} $`;

    // try init paypal when open and items exist
    maybeInitPayPal();
  }

  elCartClear?.addEventListener("click", () => { clearCart(); toast("Cart", "Cleared"); });

  async function startCheckout(){
    const cart = readCart();
    if (!cart.length){ toast("Checkout", "Cart is empty"); return; }

    try{ localStorage.setItem(SHIP_KEY, String(elShipCountry?.value || "DE").toUpperCase()); }catch(_){}

    enforceCurrencyByShipping();

    const payload = {
      currency: getCurrency(),
      shippingCountry: getShippingCountryISO2(),
      items: cart.map(it => ({ pin: String(it.pin), qty: Number(it.qty) || 1 })),
    };

    if (elCartCheckout){
      elCartCheckout.disabled = true;
      elCartCheckout.textContent = "Redirecting‚Ä¶";
    }

    try{
      const r = await fetch(API_CHECKOUT, {
        method: "POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload),
      });

      const data = await r.json().catch(()=>({}));
      if (!r.ok || !data?.ok || !data?.url){
        throw new Error(data?.error || "Checkout failed");
      }

      window.location.href = data.url;
    }catch(e){
      toast("Checkout", String(e?.message || e));
      if (elCartCheckout){
        elCartCheckout.disabled = false;
        elCartCheckout.textContent = "Checkout";
      }
    }
  }
  elCartCheckout?.addEventListener("click", startCheckout);

  // init cart
  updateCartBadge();
  renderCart();

  // ==========================
  // ‚úÖ PayPal (same logic as index)
  // ==========================
  let paypalReady = false;
  let paypalInitAttempted = false;

  function resetPayPalUI(){
    paypalReady = false;
    paypalInitAttempted = false;

    if (elPpBox) elPpBox.innerHTML = "";
    if (elPpSdk) elPpSdk.setAttribute("data-loaded","0");
    if (elPpNote){
      const cart = readCart();
      elPpNote.textContent = cart.length ? "PayPal is loading‚Ä¶" : "";
      elPpNote.style.display = cart.length ? "block" : "none";
    }
    // Remove existing sdk script if added
    const old = document.getElementById("paypal-sdk");
    if (old && old.parentNode) old.parentNode.removeChild(old);
  }

  async function loadPayPalSDK(currency){
    currency = String(currency || "EUR").toUpperCase();
    if (!elPpSdk) return false;

    const already = document.getElementById("paypal-sdk");
    if (already) return true;

    try{
      const r = await fetch("/api/paypal-client", { cache:"no-store" });
      const data = await r.json().catch(()=>({}));
      if (!r.ok || !data?.clientId) throw new Error(data?.error || "PayPal clientId missing");

      const s = document.createElement("script");
      s.id = "paypal-sdk";
      s.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(data.clientId)}&currency=${encodeURIComponent(currency)}&intent=capture`;
      s.async = true;

      const ok = await new Promise((res) => {
        s.onload = () => res(true);
        s.onerror = () => res(false);
        document.head.appendChild(s);
      });

      if (!ok) throw new Error("PayPal SDK failed to load");

      elPpSdk.setAttribute("data-loaded","1");
      return true;
    }catch(e){
      if (elPpNote) elPpNote.textContent = "PayPal unavailable";
      toast("PayPal", String(e?.message || e));
      return false;
    }
  }

  function maybeInitPayPal(){
    const cartOpen = elCartDrawer?.classList.contains("show");
    const cart = readCart();
    if (!cartOpen) return;
    if (!cart.length) return;
    if (paypalReady) return;
    if (paypalInitAttempted) return;
    paypalInitAttempted = true;

    const cur = getCurrency();
    if (elPpNote){ elPpNote.textContent = "PayPal is loading‚Ä¶"; elPpNote.style.display="block"; }

    loadPayPalSDK(cur).then((ok)=>{
      if (!ok) return;
      if (!window.paypal || !elPpBox) {
        if (elPpNote) elPpNote.textContent = "PayPal unavailable";
        return;
      }

      try{
        window.paypal.Buttons({
          style: { layout:"horizontal", tagline:false, height:44 },

          createOrder: async () => {
            enforceCurrencyByShipping();

            const payload = {
              currency: getCurrency(),
              shippingCountry: getShippingCountryISO2(),
              items: readCart().map(it => ({ pin: String(it.pin), qty: Number(it.qty) || 1 })),
              provider: "paypal"
            };

            const r = await fetch(API_CHECKOUT, {
              method:"POST",
              headers:{ "Content-Type":"application/json" },
              body: JSON.stringify(payload),
            });

            const data = await r.json().catch(()=>({}));
            if (!r.ok || !data?.ok || !data?.orderId){
              throw new Error(data?.error || "Failed to create PayPal order");
            }
            return data.orderId;
          },

          onApprove: async (data) => {
            try{
              const r = await fetch("/api/paypal-capture", {
                method:"POST",
                headers:{ "Content-Type":"application/json" },
                body: JSON.stringify({ orderId: data.orderID }),
              });
              const out = await r.json().catch(()=>({}));
              if (!r.ok || !out?.ok){
                throw new Error(out?.error || "Payment capture failed");
              }

              toast("PayPal", "Paid ‚úÖ Thank you!");
              clearCart();
              closeCart();

              if (out?.redirectUrl) window.location.href = out.redirectUrl;
            }catch(e){
              toast("PayPal", String(e?.message || e));
            }
          },

          onCancel: () => {
            toast("PayPal", "Cancelled");
          },

          onError: (err) => {
            toast("PayPal", String(err?.message || err || "PayPal error"));
          }

        }).render("#paypal-button-container");

        paypalReady = true;
        if (elPpNote) elPpNote.style.display = "none";
      }catch(e){
        if (elPpNote) elPpNote.textContent = "PayPal unavailable";
        toast("PayPal", String(e?.message || e));
      }
    });
  }

  // ==========================
  // ‚úÖ Active state (DESKTOP SIDEBAR ONLY)
  // ==========================
  (function navActive(){
    const path = (window.location.pathname || "/").toLowerCase();

    const idsDesktop = ["navShop","navAbout","navShipping","navReturns","navReviews"];
    idsDesktop.forEach(id => el(id)?.classList.remove("active"));

    const set = (id) => el(id)?.classList.add("active");

    if (path.startsWith("/shipping")) set("navShipping");
    else if (path.startsWith("/returns")) set("navReturns");
    else if (path.startsWith("/reviews")) set("navReviews");
    else if (path.startsWith("/about")) set("navAbout");
    else set("navShop");
  })();

  // ==========================
  // Reviews helpers
  // ==========================
  function starsText(r){
    r = Number(r)||0;
    let s = "";
    for (let i=1;i<=5;i++) s += (i<=r ? "‚òÖ" : "‚òÜ");
    return s;
  }
  function starsEl(r){
    const div = document.createElement("div");
    div.className = "rStars";
    div.setAttribute("aria-label", `${r} stars`);
    div.textContent = starsText(r);
    return div;
  }

  // rating picker
  const starsPick  = el("starsPick");
  const ratingText = el("ratingText");
  let rating = 5;

  function renderPicker(){
    if (!starsPick) return;
    starsPick.querySelectorAll("button.starBtn").forEach(x => x.remove());
    for (let i=1;i<=5;i++){
      const b = document.createElement("button");
      b.type = "button";
      b.className = "starBtn" + (i<=rating ? " active" : "");
      b.textContent = "‚òÖ";
      b.setAttribute("aria-label", `${i} stars`);
      b.addEventListener("click", () => {
        rating = i;
        if (ratingText) ratingText.textContent = `Selected: ${rating}/5`;
        renderPicker();
      });
      starsPick.insertBefore(b, ratingText);
    }
    if (ratingText) ratingText.textContent = `Selected: ${rating}/5`;
  }
  renderPicker();

  // ==========================
  // Lightbox (photos)
  // ==========================
  const lbBack    = el("lightboxBack");
  const lb        = el("lightbox");
  const lbImg     = el("lbImg");
  const lbClose   = el("lbClose");
  const lbCounter = el("lbCounter");

  function openPhoto(url){
    if (!lbBack || !lb || !lbImg) return;
    lbImg.src = url;
    if (lbCounter) lbCounter.textContent = "Photo";
    lbBack.classList.add("show");
    lb.classList.add("show");
    if (!isMobile()) document.body.style.overflow = "hidden";
  }
  function closePhoto(){
    lbBack?.classList.remove("show");
    lb?.classList.remove("show");
    document.body.style.overflow = "";
  }
  lbClose?.addEventListener("click", closePhoto);
  lbBack?.addEventListener("click", closePhoto);

  // ==========================
  // Reviews rendering
  // ==========================
  const elList   = el("list");
  const heroMeta = el("heroMeta");
  const countHint= el("countHint");

  const avgNum   = el("avgNum");
  const avgStars = el("avgStars");
  const avgSub   = el("avgSub");

  function fmtDate(value){
    if (!value) return "";
    const d = new Date(value);
    if (isNaN(d.getTime())) return "";
    return d.toLocaleDateString(undefined, { year:"numeric", month:"short", day:"2-digit" });
  }

  function calcAverage(items){
    const arr = (items||[]).map(x => Number(x.rating)).filter(n => Number.isFinite(n) && n>=1 && n<=5);
    if (!arr.length) return { avg:null, count:0 };
    const sum = arr.reduce((a,b)=>a+b,0);
    return { avg: sum/arr.length, count: arr.length };
  }

  function reviewCard(r){
    const wrap = document.createElement("div");
    wrap.className = "review";

    const top = document.createElement("div");
    top.className = "rTop";

    const left = document.createElement("div");
    const name = document.createElement("p");
    name.className = "rName";
    name.textContent = r.name || "Anonymous";

    const date = document.createElement("div");
    date.className = "rDate";
    const country = (r.country ? ` ‚Ä¢ ${r.country}` : "");
    date.textContent = `${fmtDate(r.createdAt || r.date || "")}${country}`;

    left.appendChild(name);
    left.appendChild(date);

    const right = starsEl(r.rating || 0);

    top.appendChild(left);
    top.appendChild(right);

    const text = document.createElement("p");
    text.className = "rText";
    text.textContent = r.text || "";

    wrap.appendChild(top);
    wrap.appendChild(text);

    // photos (if your API returns "photos": ["url", ...])
    if (Array.isArray(r.photos) && r.photos.length){
      const ph = document.createElement("div");
      ph.className = "rPhotos";
      r.photos.slice(0, 12).forEach(url => {
        const box = document.createElement("div");
        box.className = "rPhoto";
        box.innerHTML = `<img src="${escapeHtml(url)}" alt="Photo" loading="lazy" />`;
        box.addEventListener("click", ()=> openPhoto(url));
        ph.appendChild(box);
      });
      wrap.appendChild(ph);
    }

    return wrap;
  }

async function loadReviews(){
    if (heroMeta) heroMeta.textContent = "Loading‚Ä¶";
    if (elList) elList.innerHTML = "";

    try{
      const r = await fetch(API_REVIEWS, { method:"GET", cache:"no-store" });
      const data = await r.json().catch(()=>({}));
      if (!r.ok) throw new Error(data?.error || "Failed to load reviews");

      const items = Array.isArray(data?.reviews) ? data.reviews : [];
      const { avg, count } = calcAverage(items);

      const total = items.length;

      if (heroMeta){
        heroMeta.textContent = total
          ? `Showing approved reviews from customers.`
          : `No approved reviews yet. Be the first üôÇ`;
      }
      if (countHint) countHint.textContent = total ? `${total} reviews` : "‚Äî";

      if (avg == null){
        if (avgNum) avgNum.textContent = "‚Äî";
        if (avgStars) avgStars.textContent = "‚Äî";
        if (avgSub) avgSub.textContent = "No ratings yet";
      } else {
        if (avgNum) avgNum.textContent = avg.toFixed(2);
        if (avgStars) avgStars.textContent = starsText(Math.round(avg));
        if (avgSub) avgSub.textContent = `${count} ratings`;
      }

      if (!items.length){
        if (elList){
          elList.innerHTML = `<div class="empty">No reviews yet. Your review will appear after approval.</div>`;
        }
        return;
      }

      items.sort((a,b) => {
        const ad = new Date(a.createdAt || a.date || 0).getTime() || 0;
        const bd = new Date(b.createdAt || b.date || 0).getTime() || 0;
        return bd - ad;
      });

      items.forEach(it => elList?.appendChild(reviewCard(it)));
    }catch(e){
      if (heroMeta) heroMeta.textContent = "Failed to load reviews.";
      if (elList){
        elList.innerHTML = `<div class="empty">Error: ${escapeHtml(String(e?.message || e))}</div>`;
      }
      toast("Reviews", String(e?.message || e));
    }
  }

  // ==========================
  // Submit review
  // ==========================
  const elName    = el("name");
  const elCountry = el("country");
  const elText    = el("text");
  const elSend    = el("sendBtn");

  function validate(){
    const name = (elName?.value || "").trim();
    const text = (elText?.value || "").trim();
    if (name.length < 2) return "Name is too short";
    if (rating < 1 || rating > 5) return "Rating must be 1..5";
    if (text.length < 10) return "Text is too short (min 10 chars)";
    return null;
  }

  async function sendReview(){
    const err = validate();
    if (err){ toast("Review", err); return; }

    const payload = {
      name: (elName.value || "").trim(),
      country: (elCountry.value || "").trim(),
      rating: rating,
      text: (elText.value || "").trim(),
      source: "site",
    };

    if (elSend){
      elSend.disabled = true;
      elSend.textContent = "Sending‚Ä¶";
    }

    try{
      const r = await fetch(API_REVIEWS, {
        method:"POST",
        headers: { "Content-Type":"application/json" },
        body: JSON.stringify(payload),
      });
      const data = await r.json().catch(()=>({}));
      if (!r.ok || !data?.ok){
        throw new Error(data?.error || "Failed to send review");
      }

      toast("Review", "Sent ‚úÖ Waiting for approval");
      if (elText) elText.value = "";
      loadReviews();
    }catch(e){
      toast("Review", String(e?.message || e));
    }finally{
      if (elSend){
        elSend.disabled = false;
        elSend.textContent = "Send review";
      }
    }
  }

  elSend?.addEventListener("click", sendReview);

  elText?.addEventListener("keydown", (e)=>{
    if ((e.ctrlKey || e.metaKey) && e.key === "Enter") sendReview();
  });

  // load
  loadReviews();
</script>
</body>
</html>